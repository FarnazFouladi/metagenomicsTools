setwd("G:\\Goran_lab\\")

rm(list=ls())

inFileName <- "otu_withMetadata.txt"
myT <- read.table(inFileName , sep="\t", header=TRUE,row.names=1)

numCols <- ncol(myT)
myColClasses <- c(rep("character",10), rep("numeric", numCols-10))
myT <-read.table(inFileName,header=TRUE,sep="\t",colClasses=myColClasses)

pValuesmAddedSugarMedianSplit<- vector()
names <- vector()
meanNafld <- vector()
meanNonNafld <- vector()
#nafld_div_nonNafld<- vector()

index <-1
for( i in 11:ncol(myT))
	if( sum(myT[,i] != 0,na.rm=TRUE) >= nrow(myT)/4 ) 
	{	
		subset <- myT[myT$sanVsSol=="SAN",i]
		pValuesmAddedSugarMedianSplit[index] <- t.test( subset[myT$mAddedSugarMedianSplit=="1"],subset[myT$mAddedSugarMedianSplit=="0"]  )$p.value
		names[index] <- names(myT)[i]
		
		meanNafld[index] <- mean( subset[myT$mAddedSugarMedianSplit=="1"],na.rm=TRUE)
		meanNonNafld [index] <- mean( subset[myT$mAddedSugarMedianSplit=="0"],na.rm=TRUE)
		
		index <- index + 1
	}


dFrame <- data.frame( names,pValuesmAddedSugarMedianSplit, meanNafld ,meanNonNafld)
dFrame <- dFrame [order(dFrame$pValuesmAddedSugarMedianSplit),]
dFrame$adjustedP <- p.adjust( dFrame$pValuesmAddedSugarMedianSplit, method = "BH" )
write.table(dFrame, file="pValuesmAddedSugarMedianSplit_SAN.txt", sep="\t", row.names=FALSE)

