rm(list=ls())

setwd("C:\\tingData")

pdf(paste("boxplots", ".pdf", sep=""))

inFileName <- paste("otuAsColumnsLogNormPlusMetadata.txt", sep ="")
myT <-read.table(inFileName,header=TRUE,sep="\t")
numCols <- ncol(myT)
myColClasses <- c(rep("character",3), rep("numeric", numCols-3))
myT <-read.table(inFileName,header=TRUE,sep="\t",colClasses=myColClasses)
	
myT <- myT[ myT$numberSequencesPerSample >= 1000 , ]

names <- vector()
pValuesGenotype <- vector()
pValuesTime <-vector()
pValuesMaxWeightLossPercent <- vector()
	
index <- 1

for( i in c(9:ncol(myT))) 
	if( sum( myT[,i] >0 ) > nrow(myT) /4 ) 
	{	
		par(mfrow=c(2,2))
		myLm <- lm( myT[,i] ~  factor( myT$genotype) )
		myAnova <- anova(myLm)
		pValuesGenotype[index] <- myAnova$"Pr(>F)"[1]
		names[index] <- names(myT)[i]
			
			
		boxplot( myT[myT$genotype=="KO",i] ,
				myT[myT$genotype=="WT",i], main=paste(names[index], " p=" , format( pValuesGenotype[index],
				digits=3)))
			
		bug <- myT[,i]
		
		genotypes<- factor( myT$genotype)
		myFrame <- data.frame(bug, genotypes)
			
		stripchart(bug ~ genotypes, 
				data = myFrame,vertical = TRUE, pch = 21, add=TRUE, ylab = names[index])		
			
			
		lmTime <- lm(myT[,i] ~  myT$time)
		myAnovaTime <- anova(lmTime)
		pValuesTime[index] <- myAnovaTime$"Pr(>F)"[1]

	
		lmWeightLossPercent <- lm(myT[,i] ~  myT$maxWeightLossPercent)
		myAnovaLoss <- anova(lmWeightLossPercent )
		pValuesMaxWeightLossPercent[index] <- myAnovaLoss$"Pr(>F)"[1]

				
		plot( myT[,i],  myT$time, main = format( pValuesTime[index], digits=3 ))
		plot( myT[,i],  myT$maxWeightLossPercent, main = format( pValuesMaxWeightLossPercent[index], digits=3 ))
	
		index <- index + 1	
				
	}
		
hist(pValuesGenotype, breaks=20)
hist(pValuesTime,breaks=20)
hist(pValuesMaxWeightLossPercent, breaks=20)

dFrame <- data.frame( names,pValuesGenotype,pValuesTime,pValuesMaxWeightLossPercent) 
dFrame <- dFrame [order(dFrame$pValuesMaxWeightLossPercent),]
dFrame$pValuesGenotypeAdjusted <- p.adjust( dFrame$pValuesGenotype, method = "BH")
dFrame$pValuesTimeAdjusted <- p.adjust( dFrame$pValuesTime, method = "BH")
dFrame$pValuesMaxWeightLossPercentAdjust <- p.adjust( dFrame$pValuesMaxWeightLossPercent, method = "BH")
write.table(dFrame, file=paste("pValuesOtu.txt",sep=""), sep="\t",row.names=FALSE)
dev.off()
						