
setwd("C:\\uegp")

getColumnIndex <- function(myT, s)
{
	myNames <- names(myT)
	
	for( i in 1: length(myNames))
		if ( myNames[i] == s) 
			return (i)
}


#i <- 2 
for( i in 2:7 ) 
{
	fileName <- paste("LogNormwithMetadata_L_", i, ".txt", sep = "")
	myT <- read.table(fileName, sep="\t", header=TRUE)
	
	metadataStart <- getColumnIndex(myT,"sequenceCount")

	pValuesLocation <- vector()
	names <- vector()
	index <-1
	pdf( paste("L", i, ".pdf"))
	for( j in 2: (metadataStart -1) ) 
	{
		bug <- myT[,j]
		if( sum(bug != 0) > nrow(myT) / 4) 
		{
			locations <- factor(myT$Location)
			myLm <- lm( bug ~ locations) 
			names[index] <- names(myT)[j]
			pValuesLocation[index] <- anova(myLm)$"Pr(>F)"[1]
			mainText = paste(names[index], format(pValuesLocation[index], digits=3))
			boxplot( bug ~ locations, main = mainText)	
			
				
			myFrame <- data.frame(bug,locations)
			
			stripchart(bug ~ locations, 
				data = myFrame,vertical = TRUE, pch = 21, add=TRUE, ylab = names[index])	
			index = index + 1		
		} 
	}
	
	hist(pValuesLocation,breaks=20)
	dev.off()
	myFrame <- data.frame(names,pValuesLocation)
	myFrame <- myFrame [order(myFrame$pValuesLocation),]
	myFrame$adjustedPValuesLocation <- p.adjust( myFrame$pValuesLocation, method = "BH" )	
	write.table(myFrame, file=paste("L", i, "_pValues.txt",sep=""), sep="\t",row.names=FALSE)
	
}

